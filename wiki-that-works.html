<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Wikipedia</title>
  <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.7.2.2.min.js"></script>
  <style>
    body { background: #f4f7fa; font-family: 'Segoe UI', Arial, sans-serif; color: #163261; padding: 0; margin: 0; }
    h2 { background: #396ab3; color: #fff; margin: 0 0 26px 0; padding: 22px 0 11px 32px; }
    #main { max-width: 760px; background: #fff; margin: 32px auto; border-radius: 16px; box-shadow: 0 0 16px #0001; padding: 26px 3vw 36px 3vw; }
    #controls { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 19px; align-items: center; }
    #title { padding: 9px 14px; border-radius: 7px; font-size: 1.1rem; border: 1px solid #cee0f5; min-width: 210px; }
    button { padding: 9px 24px; color: #fff; background: #396ab3; border: none; border-radius: 7px; font-size: 1rem; font-weight: 600; cursor: pointer; box-shadow: 0 2px 4px #0073ff17; transition: background 120ms; }
    button:hover { background: #184b82; }
    #article { margin-top: 12px; padding: 20px 14px; background: #f7fbfe; border-radius: 9px; box-shadow: 0 0 3px #0001; min-height: 10vh; }
    #article h3 { color: #396ab3; margin-top: 0; }
    #article em { color: #7696c2; }
    #article p, #article ul, #article ol { margin-bottom: 1em; line-height: 1.6; }
    #article img { max-width: 100%; height: auto; background:#fff; display:block; margin:6px auto; box-shadow:0 1px 8px #ccc2; border-radius:4px; }
    #article a { color: #124db0; text-decoration: underline; }
    #article table { border-collapse: collapse; width: 100%; background:#fff; }
    #article th, #article td {border:1px solid #ccd4e1; padding: 4px; font-size:.97em; }
  </style>
</head>
<body>
  <h2> Wikipedia</h2>
  <div id="main">
    <div id="controls">
      <input id="title" placeholder="Wikipedia article (e.g. Rocket)">
      <button onclick="sendWiki()">Fetch & Share</button>
    </div>
    <div id="article">Nothing yet.</div>
  </div>
  <script>
    const pubnub = new PubNub({
      publishKey: '
      uuid: 'wiki_' + Math.random().toString(36).slice(2,8)
    });
    pubnub.subscribe({channels:['wiki-demo']});
    pubnub.addListener({
      message: function(evt) {
        showArticle(evt.message.title, evt.message.html, true);
      }
    });
    function sendWiki() {
      const t = document.getElementById('title').value.trim();
      if (!t) return;
      fetch('https://en.wikipedia.org/api/rest_v1/page/html/'+encodeURIComponent(t))
        .then(r=>r.text())
        .then(html=>{
          pubnub.publish({channel:'wiki-demo', message:{title:t,html:html}});
          showArticle(t, html, false);
        });
    }
    function fixWikiImages() {
      document.querySelectorAll('#article img').forEach(function(img) {
        let src = img.getAttribute('src');
        if(src && src.startsWith('//')) img.src = 'https:' + src;
        else if(src && src.startsWith('/')) img.src = 'https://en.wikipedia.org' + src;
      });
    }
    function showArticle(title, html, remote) {
      document.getElementById('article').innerHTML =
        '<h3>'+title+'</h3>'+
        html +
        (remote ? '<div><em>(From another user)</em></div>' : '');
      fixWikiImages();
    }
  </script>
</body>
</html>
